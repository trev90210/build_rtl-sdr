name: libusb Windows build and Package

on: [workflow_dispatch, push, pull_request]

defaults:
  run:
    shell: PowerShell

jobs:
  build:
    strategy:
      matrix:
        os:
        #  - 'windows-2022'
          - 'windows-2025'
        configuration:
          - 'Release'
        architecture:
          - 'Win32'
          - 'x64'
          - 'ARM64'
          
    runs-on: ${{ matrix.os }}

    steps:
      - name: install
        run: |
          choco install wget innoextract --no-progress

      - name: Checkout code
        uses: actions/checkout@v4

      - name: clone
        run: |
          git clone https://github.com/trev90210/libusb
          cd libusb
          ls

      - name: Setup MSBuild
        uses: microsoft/setup-msbuild@v2
        

    
      - name: Configure Visual Studio and CMake
        working-directory: ${{runner.workspace}}
        run: |
            cd ${{ github.workspace }}
            msbuild libusb/msvc/libusb.sln `
                /m `
                -property:Configuration=Release `
                -property:Platform=${{ matrix.architecture }}
    
      - name: List
        working-directory: ${{runner.workspace}}
        run: |
            ls -Recurse -Exclude ".git" -Path  "${{ github.workspace }}"
